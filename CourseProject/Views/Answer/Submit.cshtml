@model TemplateSubmissionViewModel
@{
    ViewData["Title"] = Model.Title;
}

<div class="container py-5">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0">@Model.Title</h2>
        </div>
        <div class="card-body">
            @if (!string.IsNullOrEmpty(Model.Description))
            {
                <div class="mb-4">
                    <p class="lead">@Model.Description</p>
                </div>
            }
            <form method="post">
                <input type="hidden" name="templateId" value="@Model.TemplateId" />

                @for (int i = 0; i < Model.Forms.Count; i++)
                {
                    var form = Model.Forms[i];
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h5 class="mb-0">
                                <span data-i18n="FormNumber" data-i18n-options='{"number": @(i + 1)}'></span>
                            </h5>
                        </div>
                        <div class="card-body">
                            <input type="hidden" name="[@i].FormId" value="@form.FormId" />
                            <input type="hidden" name="[@i].QuestionId" value="@form.Question.Id" />
                            <input type="hidden" name="[@i].QuestionType" value="@form.Question.Type" />
                            <div class="mb-3">
                                <label class="form-label fw-bold">@form.Question.Title</label>
                                @if (!string.IsNullOrEmpty(form.Question.Description))
                                {
                                    <p class="text-muted mb-3">@form.Question.Description</p>
                                }

                                @switch (form.Question.Type)
                                {
                                    case CourseProject.Entities.QuestionType.SingleLine:
                                        <input type="text" name="[@i].TextAnswer" class="form-control" required
                                               maxlength="@(form.Question.MaxLength ?? int.MaxValue)" />
                                        @if (form.Question.MaxLength != null)
                                        {
                                            <small class="text-muted">
                                                Max length: @form.Question.MaxLength characters
                                            </small>
                                        }
                                        break;
                                    case CourseProject.Entities.QuestionType.MultiLine:
                                        <textarea name="[@i].TextAnswer" class="form-control" rows="3" required></textarea>
                                        break;
                                    case CourseProject.Entities.QuestionType.Integer:
                                        <input type="number" name="[@i].TextAnswer" class="form-control" required
                                               min="@(form.Question.MinValue ?? int.MinValue)"
                                               max="@(form.Question.MaxValue ?? int.MaxValue)" />
                                        @if (form.Question.MinValue != null || form.Question.MaxValue != null)
                                        {
                                            <small class="text-muted">
                                                @if (form.Question.MinValue != null && form.Question.MaxValue != null)
                                                {
                                                    @($"Allowed range: {form.Question.MinValue} – {form.Question.MaxValue}")
                                                }
                                                else if (form.Question.MinValue != null)
                                                {
                                                    @($"Minimum: {form.Question.MinValue}")
                                                }
                                                else if (form.Question.MaxValue != null)
                                                {
                                                    @($"Maximum: {form.Question.MaxValue}")
                                                }
                                            </small>
                                        }
                                        break;
                                    case CourseProject.Entities.QuestionType.Checkbox:
                                        @if (form.Options != null)
                                        {
                                            <div class="mt-2">
                                                @foreach (var option in form.Options)
                                                {
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="checkbox"
                                                               name="[@i].SelectedOptions" value="@option.Id"
                                                               id="option_@option.Id">
                                                        <label class="form-check-label" for="option_@option.Id">
                                                            @option.Text
                                                        </label>
                                                    </div>
                                                }
                                            </div>
                                        }
                                        break;
                                }
                            </div>
                        </div>
                    </div>
                }
                <div class="d-flex justify-content-between">
                    <a href="javascript:history.back()" class="btn btn-secondary" data-i18n="Cancel">Cancel</a>
                    <button type="submit" class="btn btn-primary" data-i18n="SubmitAnswer">Submit Answers</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}